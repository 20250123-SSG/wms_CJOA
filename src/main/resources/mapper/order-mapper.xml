<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cjoa.wms.dao.OrderMapper">
    <resultMap id="resultOrderDeliveryListMap" type="OrderDelivery">
        <id column="order_code" property="orderCode"/>
        <result column="user_code" property="userCode"/>
        <result column="order_pay_type" property="orderPayType"/>
        <result column="order_price" property="orderPrice"/>
        <result column="order_status" property="orderStatus"/>
        <result column="order_date" property="orderDate"/>
        <result column="order_request" property="orderRequest"/>
        <result column="order_delivery_phone" property="orderDeliveryPhone"/>
        <result column="order_delivery_address" property="orderDeliveryAddress"/>
        <result column="order_delivery_name" property="orderDeliveryName"/>

        <collection property="cartList" ofType="Cart">
            <result column="cartQuantity" property="cart_quantity"/>
        </collection>
    </resultMap>

    <insert id="insertOrderTableByUser" parameterType="OrderProdOptionDelivery">
        Insert INTO
        tbl_order
        (
        user_code
        , order_pay_type
        , order_price
        )
        VALUES
        (
        #{userCode}
        , #{orderPayType}
        , #{orderPrice}
        )
    </insert>

    <insert id="insertOrderDeliveryTableByUser" parameterType="OrderProdOptionDelivery" useGeneratedKeys="true" keyProperty="orderCode">
        INSERT INTO
        tbl_order_delivery
        (
        order_code
        , order_request
        , order_delivery_phone
        , order_delivery_address
        , order_delivery_name
        )
        VALUES
        (
          #{orderCode}
        , #{orderRequest}
        , #{orderDeliveryPhone}
        , #{orderDeliveryAddress}
        , #{orderDeliveryName}
        )
    </insert>



    <insert id="insertOrderProdOptionByUser" parameterType="OrderProdOptionDelivery" useGeneratedKeys="true" keyProperty="orderCode">
        INSERT INTO tbl_order_prod_option (
        order_prod_option_quantity,
        order_code,
        prod_option_code
        )
        SELECT
        c.cart_quantity,
        #{orderCode},      -- 주문 테이블 insert 후 생성된 key
        po.prod_option_code
        FROM tbl_prod_option po
        JOIN tbl_cart c ON po.prod_option_code = c.prod_option_code
        WHERE c.user_id = #{userId}
    </insert>


  
</mapper>